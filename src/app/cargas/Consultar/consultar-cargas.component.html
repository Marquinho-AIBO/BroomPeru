<h2>Lista Registros Existente</h2>
<h2>Registros cargados</h2>

<ng-container *ngIf="userProfile === 'Administrador'">
  <div class="modal-backdrop" *ngIf="mostrarModal">
    <div class="modal">
      <div class="modal-header">
        <h3>Editar Registro</h3>
        <button class="cerrar-modal" (click)="cerrarModal()">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="guardarRegistro()">
        <div class="cont-form-nr">
          <div class="form-group" *ngFor="let campo of campos">
            <label>{{ campo.label }}:</label>
          
            <!-- Campos con valores predefinidos -->
            <select *ngIf="['MES','COM','STATUS','TIPO','SERVICIO','COND.'].includes(campo.key)"
                    [(ngModel)]="carga[campo.key]" [name]="campo.key">
              <option *ngFor="let valor of obtenerValoresPorCampo(campo.key)" [value]="valor">{{ valor }}</option>
            </select>
          
            <!-- Campo comentarios -->
            <textarea *ngIf="campo.key === 'COMENTARIOS'"
                      [(ngModel)]="carga[campo.key]" [name]="campo.key"></textarea>
          
            <!-- Otros campos -->
            <input *ngIf="!['MES','COM','STATUS','TIPO','SERVICIO','COND.','COMENTARIOS', 'RUC'].includes(campo.key)"
                   [type]="campo.key.includes('FECHA') || campo.key === 'ATA' || campo.key === 'ATD' ? 'date' : (campo.key === 'FECHA_HORA_TRANSMISION' ? 'datetime-local' : 'text')"
                   [(ngModel)]="carga[campo.key]" [name]="campo.key" />
            <input *ngIf="['RUC'].includes(campo.key)" [(ngModel)]="carga[campo.key]" [name]="campo.key" disabled/>
          </div>
        </div>
      </form>
      </div>
      <div class="actions">
        <button class="btn-solid add" type="submit">
          <span>{{ modoEdicion ? 'Modificar' : 'Guardar' }}</span>
          <span class="material-symbols-outlined">save</span>
        </button>
        <button class="btn-solid close" type="button" (click)="cerrarModal()">
          <span>Cerrar</span>
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="userProfile === 'Empresa' || userProfile === 'Aduana'">
  <div class="modal-backdrop" *ngIf="mostrarModal">
    <div class="modal">
      <button class="cerrar-modal" (click)="cerrarModal()">
        <span class="material-symbols-outlined">close</span>
      </button>
      <h3>Detalle de Registro</h3>
      <div class="cont-form-nr">
        <div class="form-group" *ngFor="let campo of campos">
          <ng-container *ngIf="columnasVisibles[campo.key]">
            <label>{{ campo.label }}:</label>
            <span>{{ carga[campo.key] }}</span>
          </ng-container>
        </div>
      </div>
      <div class="actions">
        <button class="btn-solid close" type="button" (click)="cerrarModal()">
          <span>Cerrar</span>
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>
  </div>
</ng-container>

<div class="wrap-actions">
  <input type="text" [(ngModel)]="filtroTexto" placeholder="Buscar..." class="form-control mb-2 buscador" />
  <button class="btn-solid export" (click)="exportarDatosFiltradosCSV()">
    <span>Exportar Excel.CSV</span>
    <span class="material-symbols-outlined">download</span>
  </button>
</div>
<div class="cont-table">
  <table>
    <thead>
      <tr>
        <th *ngFor="let campo of campos" [hidden]="!columnasVisibles[campo.key]">{{ campo.label }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let reg of registrosFiltradosPaginados()"
          (click)="cargarEnFormulario(reg)"
          [class.clickable]="userProfile === 'Administrador' || userProfile === 'Empresa' || userProfile === 'Aduana'">
        <td *ngFor="let campo of campos" [hidden]="!columnasVisibles[campo.key]">{{ reg[campo.key] }}</td>
      </tr>
    </tbody>
  </table>
</div>
<nav aria-label="Page navigation">
  <ul class="pagination">
    <li class="page-item" [class.disabled]="paginaActual === 1">
      <a class="page-nav" (click)="paginaActual = paginaActual - 1" [class.disabled]="paginaActual === 1">Anterior</a>
    <li class="page-item" *ngFor="let p of totalPaginas()" [class.active]="paginaActual === p">
      <a class="page-link" (click)="paginaActual = p">{{ p }}</a>
    </li>
    <li class="page-item" [class.disabled]="paginaActual === totalPaginas().length">
      <a class="page-nav" (click)="paginaActual = paginaActual + 1" [class.disabled]="paginaActual === totalPaginas().length">Siguiente</a>

    </li>
  </ul>
</nav>
